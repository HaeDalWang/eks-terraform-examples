
providers:
  kubernetesIngress:
    publishedService:
      enabled: true
  file:
    enabled: true
    content: |
      ${providers_file_content}
  # kubernetesGateway:
  #   enabled: true
service:
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: external
    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing
    service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp
    service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "443"
    service.beta.kubernetes.io/aws-load-balancer-ssl-cert: ${acm_certificate_arn}
    service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: "*"
    service.beta.kubernetes.io/aws-load-balancer-attributes: load_balancing.cross_zone.enabled=true
    # Traefik 서비스 자체는 external-dns에서 제외 (CNAME 루프 방지)
    external-dns.alpha.kubernetes.io/exclude: "true"
ports:
  web:
    proxyProtocol:
      trustedIPs:
        - ${vpc_cidr}
    forwardedHeaders:
      trustedIPs:
        - ${vpc_cidr}
    middlewares:
      - forwardedHeader@file
  websecure:
    targetPort: web
    tls:
      enabled: false
  traefik:
    expose:
      default: true
additionalArguments:
  - "--api.insecure=true"

logs:
  access:
    enabled: true
    format: json
resources:
  requests:
    cpu: 200m
    memory: 256Mi
autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 3
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 70