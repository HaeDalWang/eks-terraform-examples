http:
  middlewares:
    # -----------------------------
    # Forwarded Header (NLB에서 Proxy Protocol 사용 시)
    # -----------------------------
    forwardedHeader:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
          X-Forwarded-Port: "443"
    # -----------------------------
    # HTTPS 강제 리다이렉트
    # -----------------------------
    https-redirect:
      redirectScheme:
        scheme: https
        permanent: true
    # -----------------------------
    # 보안 + 캐시 방지 헤더
    # (NGINX configuration-snippet 대체)
    # -----------------------------
    security-headers:
      headers:
        contentTypeNosniff: true
        frameDeny: true
        browserXssFilter: true

        customResponseHeaders:
          Pragma: "no-cache"
          Cache-Control: "max-age=0, no-store, no-cache, must-revalidate"
    # -----------------------------
    # CORS 설정
    # -----------------------------
    cors:
      headers:
        addVaryHeader: true
        accessControlAllowMethods:
          - GET
          - POST
          - HEAD
          - OPTIONS
        accessControlAllowHeaders:
          - X-Forwarded-For
        # accessControlAllowCredentials: true
        # Traefik CORS 미들웨어는 accessControlAllowOriginList 또는 accessControlAllowOriginListRegex 중 하나가 필수
        accessControlAllowOriginList:
          - "*" 
        # accessControlAllowOriginListRegex:
        #   - "^https://.*\\.seungdobae\\.com$"
        #   - "^https://seungdobae\\.com$"
    # -----------------------------
    # 공통 미들웨어 체인
    # -----------------------------
    app-chain:
      chain:
        middlewares:
          - security-headers
          - cors
  # -----------------------------
  # Backend timeout (proxy read/send)
  # -----------------------------
  serversTransports:
    backend-timeout:
      forwardingTimeouts:
        responseHeaderTimeout: 60s
        idleConnTimeout: 60s
    
    backend-timeout-30:
      forwardingTimeouts:
        responseHeaderTimeout: 30s
        idleConnTimeout: 30s