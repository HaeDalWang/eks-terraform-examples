# Terraform ê´€ë¦¬ Makefile

.PHONY: help login plan apply destroy fmt validate

# ê¸°ë³¸ íƒ€ê²Ÿ
.DEFAULT_GOAL := help

help: ## ë„ì›€ë§ í‘œì‹œ
	@echo "ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

login: ## ECR Public ë¡œê·¸ì¸
	@echo "ğŸ” ECR Public ë¡œê·¸ì¸ ì¤‘..."
	@aws ecr-public get-login-password --region us-east-1 | helm registry login --username AWS --password-stdin public.ecr.aws
	@echo "âœ… ë¡œê·¸ì¸ ì™„ë£Œ"

plan: login ## Terraform ê³„íš í™•ì¸ (ìë™ ë¡œê·¸ì¸ í¬í•¨)
	@echo "ğŸ“‹ Terraform ê³„íš í™•ì¸ ì¤‘..."
	terraform plan

apply: login ## Terraform ì ìš© (ìë™ ë¡œê·¸ì¸ í¬í•¨)
	@echo "ğŸš€ Terraform ì ìš© ì¤‘..."
	terraform apply

apply-auto: login ## Terraform ìë™ ì ìš© (í™•ì¸ ì—†ì´)
	@echo "ğŸš€ Terraform ìë™ ì ìš© ì¤‘..."
	terraform apply -auto-approve

destroy: login ## Terraform ë¦¬ì†ŒìŠ¤ ì‚­ì œ
	@echo "ğŸ’¥ Terraform ë¦¬ì†ŒìŠ¤ ì‚­ì œ ì¤‘..."
	terraform destroy

fmt: ## Terraform ì½”ë“œ í¬ë§·íŒ…
	terraform fmt -recursive

validate: ## Terraform ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬
	terraform validate

init: ## Terraform ì´ˆê¸°í™”
	terraform init

refresh: login ## Terraform ìƒíƒœ ìƒˆë¡œê³ ì¹¨
	terraform refresh

# ì•„ì¹¨ ë°°í¬ìš© ì›ìŠ¤í†± ëª…ë ¹ì–´
morning-deploy: login plan apply-auto ## ğŸŒ… ì•„ì¹¨ ë°°í¬ (ë¡œê·¸ì¸ â†’ ê³„íš â†’ ìë™ ì ìš©)
	@echo "â˜• ì•„ì¹¨ ë°°í¬ ì™„ë£Œ! ì»¤í”¼ í•œ ì” í•˜ì„¸ìš”~"
